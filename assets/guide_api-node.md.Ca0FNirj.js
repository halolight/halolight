import{_ as a,c as i,o as n,a3 as t}from"./chunks/framework.BuRUkFgc.js";const c=JSON.parse('{"title":"Node.js Express åç«¯ API","description":"","frontmatter":{},"headers":[],"relativePath":"guide/api-node.md","filePath":"guide/api-node.md","lastUpdated":1765973614000}'),e={name:"guide/api-node.md"};function l(p,s,h,r,d,k){return n(),i("div",{"data-pagefind-body":!0,"data-pagefind-meta":"date:1765973614000"},[...s[0]||(s[0]=[t(`<h1 id="node-js-express-åç«¯-api" tabindex="-1">Node.js Express åç«¯ API <a class="header-anchor" href="#node-js-express-åç«¯-api" aria-label="Permalink to &quot;Node.js Express åç«¯ API&quot;">â€‹</a></h1><p>HaloLight Node.js åç«¯ API åŸºäº Express 5 + TypeScript + Prisma æ„å»ºï¼Œæä¾›ä¼ä¸šçº§ RESTful API æœåŠ¡ã€‚</p><p><strong>API æ–‡æ¡£</strong>ï¼š<a href="https://halolight-api-node.h7ml.cn/docs" target="_blank" rel="noreferrer">https://halolight-api-node.h7ml.cn/docs</a></p><p><strong>GitHub</strong>ï¼š<a href="https://github.com/halolight/halolight-api-node" target="_blank" rel="noreferrer">https://github.com/halolight/halolight-api-node</a></p><h2 id="ç‰¹æ€§" tabindex="-1">ç‰¹æ€§ <a class="header-anchor" href="#ç‰¹æ€§" aria-label="Permalink to &quot;ç‰¹æ€§&quot;">â€‹</a></h2><ul><li>ğŸ” <strong>JWT åŒä»¤ç‰Œ</strong> - Access Token + Refresh Tokenï¼Œè‡ªåŠ¨ç»­æœŸ</li><li>ğŸ›¡ï¸ <strong>RBAC æƒé™</strong> - åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œé€šé…ç¬¦åŒ¹é…</li><li>ğŸ“¡ <strong>RESTful API</strong> - æ ‡å‡†åŒ–æ¥å£è®¾è®¡ï¼ŒOpenAPI æ–‡æ¡£</li><li>ğŸ—„ï¸ <strong>Prisma ORM</strong> - ç±»å‹å®‰å…¨çš„æ•°æ®åº“æ“ä½œ</li><li>âœ… <strong>æ•°æ®éªŒè¯</strong> - Zod è¯·æ±‚å‚æ•°æ ¡éªŒï¼Œé”™è¯¯å¤„ç†</li><li>ğŸ“Š <strong>æ—¥å¿—ç³»ç»Ÿ</strong> - Pino æ—¥å¿—è®°å½•ï¼Œè¯·æ±‚è¿½è¸ª</li><li>ğŸ³ <strong>Docker æ”¯æŒ</strong> - å®¹å™¨åŒ–éƒ¨ç½²</li><li>ğŸ¯ <strong>12 ä¸ªä¸šåŠ¡æ¨¡å—</strong> - 90+ RESTful ç«¯ç‚¹</li></ul><h2 id="æŠ€æœ¯æ ˆ" tabindex="-1">æŠ€æœ¯æ ˆ <a class="header-anchor" href="#æŠ€æœ¯æ ˆ" aria-label="Permalink to &quot;æŠ€æœ¯æ ˆ&quot;">â€‹</a></h2><table tabindex="0"><thead><tr><th>æŠ€æœ¯</th><th>ç‰ˆæœ¬</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Node.js</td><td>20+</td><td>JavaScript è¿è¡Œæ—¶</td></tr><tr><td>Express</td><td>5.x</td><td>Web æ¡†æ¶</td></tr><tr><td>Prisma</td><td>6.x</td><td>æ•°æ®åº“ ORM</td></tr><tr><td>PostgreSQL</td><td>16</td><td>æ•°æ®å­˜å‚¨</td></tr><tr><td>Zod</td><td>3.x</td><td>æ•°æ®éªŒè¯</td></tr><tr><td>JWT</td><td>9.x</td><td>èº«ä»½è®¤è¯</td></tr><tr><td>Pino</td><td>9.x</td><td>æ—¥å¿—ç³»ç»Ÿ</td></tr><tr><td>Swagger UI</td><td>5.x</td><td>API æ–‡æ¡£</td></tr></tbody></table><h2 id="å¿«é€Ÿå¼€å§‹" tabindex="-1">å¿«é€Ÿå¼€å§‹ <a class="header-anchor" href="#å¿«é€Ÿå¼€å§‹" aria-label="Permalink to &quot;å¿«é€Ÿå¼€å§‹&quot;">â€‹</a></h2><h3 id="ç¯å¢ƒè¦æ±‚" tabindex="-1">ç¯å¢ƒè¦æ±‚ <a class="header-anchor" href="#ç¯å¢ƒè¦æ±‚" aria-label="Permalink to &quot;ç¯å¢ƒè¦æ±‚&quot;">â€‹</a></h3><ul><li>Node.js &gt;= 20</li><li>pnpm &gt;= 9</li><li>PostgreSQL (å¯é€‰ï¼Œé»˜è®¤ SQLite)</li></ul><h3 id="å®‰è£…" tabindex="-1">å®‰è£… <a class="header-anchor" href="#å®‰è£…" aria-label="Permalink to &quot;å®‰è£…&quot;">â€‹</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å…‹éš†ä»“åº“</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/halolight/halolight-api-node.git</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> halolight-api-node</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å®‰è£…ä¾èµ–</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="ç¯å¢ƒå˜é‡" tabindex="-1">ç¯å¢ƒå˜é‡ <a class="header-anchor" href="#ç¯å¢ƒå˜é‡" aria-label="Permalink to &quot;ç¯å¢ƒå˜é‡&quot;">â€‹</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env.example</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-env vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">env</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># æ•°æ®åº“</span></span>
<span class="line"><span>DATABASE_URL=&quot;postgresql://user:password@localhost:5432/halolight?schema=public&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># JWT å¯†é’¥ï¼ˆå¿…é¡» â‰¥32 å­—ç¬¦ï¼‰</span></span>
<span class="line"><span>JWT_SECRET=&quot;your-super-secret-jwt-key-minimum-32-characters-long&quot;</span></span>
<span class="line"><span>JWT_EXPIRES_IN=7d</span></span>
<span class="line"><span>REFRESH_TOKEN_SECRET=&quot;your-refresh-secret-key-minimum-32-characters-long&quot;</span></span>
<span class="line"><span>REFRESH_TOKEN_EXPIRES_IN=30d</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æœåŠ¡é…ç½®</span></span>
<span class="line"><span>PORT=3001</span></span>
<span class="line"><span>NODE_ENV=development</span></span>
<span class="line"><span></span></span>
<span class="line"><span># CORS</span></span>
<span class="line"><span>CORS_ORIGIN=&quot;http://localhost:3000&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="æ•°æ®åº“åˆå§‹åŒ–" tabindex="-1">æ•°æ®åº“åˆå§‹åŒ– <a class="header-anchor" href="#æ•°æ®åº“åˆå§‹åŒ–" aria-label="Permalink to &quot;æ•°æ®åº“åˆå§‹åŒ–&quot;">â€‹</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç”Ÿæˆ Prisma Client</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db:generate</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ¨é€æ•°æ®åº“å˜æ›´</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db:push</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¡«å……ç§å­æ•°æ®ï¼ˆå¯é€‰ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db:seed</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="å¯åŠ¨æœåŠ¡" tabindex="-1">å¯åŠ¨æœåŠ¡ <a class="header-anchor" href="#å¯åŠ¨æœåŠ¡" aria-label="Permalink to &quot;å¯åŠ¨æœåŠ¡&quot;">â€‹</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¼€å‘æ¨¡å¼</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç”Ÿäº§æ¨¡å¼</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>è®¿é—® <a href="http://localhost:3001" target="_blank" rel="noreferrer">http://localhost:3001</a></p><h2 id="é¡¹ç›®ç»“æ„" tabindex="-1">é¡¹ç›®ç»“æ„ <a class="header-anchor" href="#é¡¹ç›®ç»“æ„" aria-label="Permalink to &quot;é¡¹ç›®ç»“æ„&quot;">â€‹</a></h2><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>halolight-api-node/</span></span>
<span class="line"><span>â”œâ”€â”€ src/</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ routes/               # æ§åˆ¶å™¨/è·¯ç”±å¤„ç†</span></span>
<span class="line"><span>â”‚   â”‚   â”œâ”€â”€ auth.ts          # è®¤è¯è·¯ç”±</span></span>
<span class="line"><span>â”‚   â”‚   â”œâ”€â”€ users.ts         # ç”¨æˆ·ç®¡ç†</span></span>
<span class="line"><span>â”‚   â”‚   â”œâ”€â”€ roles.ts         # è§’è‰²ç®¡ç†</span></span>
<span class="line"><span>â”‚   â”‚   â”œâ”€â”€ permissions.ts   # æƒé™ç®¡ç†</span></span>
<span class="line"><span>â”‚   â”‚   â”œâ”€â”€ teams.ts         # å›¢é˜Ÿç®¡ç†</span></span>
<span class="line"><span>â”‚   â”‚   â”œâ”€â”€ documents.ts     # æ–‡æ¡£ç®¡ç†</span></span>
<span class="line"><span>â”‚   â”‚   â”œâ”€â”€ files.ts         # æ–‡ä»¶ç®¡ç†</span></span>
<span class="line"><span>â”‚   â”‚   â”œâ”€â”€ folders.ts       # æ–‡ä»¶å¤¹ç®¡ç†</span></span>
<span class="line"><span>â”‚   â”‚   â”œâ”€â”€ calendar.ts      # æ—¥å†äº‹ä»¶</span></span>
<span class="line"><span>â”‚   â”‚   â”œâ”€â”€ notifications.ts # é€šçŸ¥ç®¡ç†</span></span>
<span class="line"><span>â”‚   â”‚   â”œâ”€â”€ messages.ts      # æ¶ˆæ¯ç®¡ç†</span></span>
<span class="line"><span>â”‚   â”‚   â””â”€â”€ dashboard.ts     # ä»ªè¡¨ç›˜ç»Ÿè®¡</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘å±‚</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ middleware/          # ä¸­é—´ä»¶</span></span>
<span class="line"><span>â”‚   â”‚   â”œâ”€â”€ auth.ts          # JWT è®¤è¯ + RBAC</span></span>
<span class="line"><span>â”‚   â”‚   â”œâ”€â”€ validate.ts      # Zod è¯·æ±‚éªŒè¯</span></span>
<span class="line"><span>â”‚   â”‚   â””â”€â”€ error.ts         # å…¨å±€é”™è¯¯å¤„ç†</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ config/              # é…ç½®æ–‡ä»¶</span></span>
<span class="line"><span>â”‚   â”‚   â”œâ”€â”€ env.ts           # ç¯å¢ƒå˜é‡</span></span>
<span class="line"><span>â”‚   â”‚   â””â”€â”€ swagger.ts       # Swagger é…ç½®</span></span>
<span class="line"><span>â”‚   â””â”€â”€ index.ts             # åº”ç”¨å…¥å£</span></span>
<span class="line"><span>â”œâ”€â”€ prisma/                  # æ•°æ®åº“è¿ç§»/Schema</span></span>
<span class="line"><span>â”‚   â””â”€â”€ schema.prisma        # æ•°æ®åº“æ¨¡å‹ï¼ˆ17+ æ¨¡å‹ï¼‰</span></span>
<span class="line"><span>â”œâ”€â”€ tests/                   # æµ‹è¯•æ–‡ä»¶</span></span>
<span class="line"><span>â”œâ”€â”€ Dockerfile               # Docker é…ç½®</span></span>
<span class="line"><span>â”œâ”€â”€ docker-compose.yml</span></span>
<span class="line"><span>â””â”€â”€ package.json</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h2 id="api-æ¨¡å—" tabindex="-1">API æ¨¡å— <a class="header-anchor" href="#api-æ¨¡å—" aria-label="Permalink to &quot;API æ¨¡å—&quot;">â€‹</a></h2><h3 id="è®¤è¯ç›¸å…³ç«¯ç‚¹" tabindex="-1">è®¤è¯ç›¸å…³ç«¯ç‚¹ <a class="header-anchor" href="#è®¤è¯ç›¸å…³ç«¯ç‚¹" aria-label="Permalink to &quot;è®¤è¯ç›¸å…³ç«¯ç‚¹&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>æ–¹æ³•</th><th>è·¯å¾„</th><th>æè¿°</th><th>æƒé™</th></tr></thead><tbody><tr><td>POST</td><td><code>/api/auth/login</code></td><td>ç”¨æˆ·ç™»å½•</td><td>å…¬å¼€</td></tr><tr><td>POST</td><td><code>/api/auth/register</code></td><td>ç”¨æˆ·æ³¨å†Œ</td><td>å…¬å¼€</td></tr><tr><td>POST</td><td><code>/api/auth/refresh</code></td><td>åˆ·æ–°ä»¤ç‰Œ</td><td>å…¬å¼€</td></tr><tr><td>POST</td><td><code>/api/auth/logout</code></td><td>é€€å‡ºç™»å½•</td><td>éœ€è®¤è¯</td></tr><tr><td>POST</td><td><code>/api/auth/forgot-password</code></td><td>å¿˜è®°å¯†ç </td><td>å…¬å¼€</td></tr><tr><td>POST</td><td><code>/api/auth/reset-password</code></td><td>é‡ç½®å¯†ç </td><td>å…¬å¼€</td></tr></tbody></table><h3 id="ç”¨æˆ·ç®¡ç†ç«¯ç‚¹" tabindex="-1">ç”¨æˆ·ç®¡ç†ç«¯ç‚¹ <a class="header-anchor" href="#ç”¨æˆ·ç®¡ç†ç«¯ç‚¹" aria-label="Permalink to &quot;ç”¨æˆ·ç®¡ç†ç«¯ç‚¹&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>æ–¹æ³•</th><th>è·¯å¾„</th><th>æè¿°</th><th>æƒé™</th></tr></thead><tbody><tr><td>GET</td><td><code>/api/users</code></td><td>è·å–ç”¨æˆ·åˆ—è¡¨</td><td><code>users:view</code></td></tr><tr><td>GET</td><td><code>/api/users/:id</code></td><td>è·å–ç”¨æˆ·è¯¦æƒ…</td><td><code>users:view</code></td></tr><tr><td>POST</td><td><code>/api/users</code></td><td>åˆ›å»ºç”¨æˆ·</td><td><code>users:create</code></td></tr><tr><td>PUT</td><td><code>/api/users/:id</code></td><td>æ›´æ–°ç”¨æˆ·</td><td><code>users:update</code></td></tr><tr><td>DELETE</td><td><code>/api/users/:id</code></td><td>åˆ é™¤ç”¨æˆ·</td><td><code>users:delete</code></td></tr><tr><td>GET</td><td><code>/api/users/me</code></td><td>è·å–å½“å‰ç”¨æˆ·</td><td>éœ€è®¤è¯</td></tr></tbody></table><h3 id="å®Œæ•´ç«¯ç‚¹æ¸…å•" tabindex="-1">å®Œæ•´ç«¯ç‚¹æ¸…å• <a class="header-anchor" href="#å®Œæ•´ç«¯ç‚¹æ¸…å•" aria-label="Permalink to &quot;å®Œæ•´ç«¯ç‚¹æ¸…å•&quot;">â€‹</a></h3><h4 id="è§’è‰²ç®¡ç†-roles-6-ä¸ªç«¯ç‚¹" tabindex="-1">è§’è‰²ç®¡ç† (Roles) - 6 ä¸ªç«¯ç‚¹ <a class="header-anchor" href="#è§’è‰²ç®¡ç†-roles-6-ä¸ªç«¯ç‚¹" aria-label="Permalink to &quot;è§’è‰²ç®¡ç† (Roles) - 6 ä¸ªç«¯ç‚¹&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>æ–¹æ³•</th><th>è·¯å¾„</th><th>æè¿°</th></tr></thead><tbody><tr><td>GET</td><td><code>/api/roles</code></td><td>è·å–è§’è‰²åˆ—è¡¨</td></tr><tr><td>GET</td><td><code>/api/roles/:id</code></td><td>è·å–è§’è‰²è¯¦æƒ…</td></tr><tr><td>POST</td><td><code>/api/roles</code></td><td>åˆ›å»ºè§’è‰²</td></tr><tr><td>PUT</td><td><code>/api/roles/:id</code></td><td>æ›´æ–°è§’è‰²</td></tr><tr><td>DELETE</td><td><code>/api/roles/:id</code></td><td>åˆ é™¤è§’è‰²</td></tr><tr><td>PUT</td><td><code>/api/roles/:id/permissions</code></td><td>åˆ†é…æƒé™</td></tr></tbody></table><h4 id="æƒé™ç®¡ç†-permissions-4-ä¸ªç«¯ç‚¹" tabindex="-1">æƒé™ç®¡ç† (Permissions) - 4 ä¸ªç«¯ç‚¹ <a class="header-anchor" href="#æƒé™ç®¡ç†-permissions-4-ä¸ªç«¯ç‚¹" aria-label="Permalink to &quot;æƒé™ç®¡ç† (Permissions) - 4 ä¸ªç«¯ç‚¹&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>æ–¹æ³•</th><th>è·¯å¾„</th><th>æè¿°</th></tr></thead><tbody><tr><td>GET</td><td><code>/api/permissions</code></td><td>è·å–æƒé™åˆ—è¡¨</td></tr><tr><td>GET</td><td><code>/api/permissions/:id</code></td><td>è·å–æƒé™è¯¦æƒ…</td></tr><tr><td>POST</td><td><code>/api/permissions</code></td><td>åˆ›å»ºæƒé™</td></tr><tr><td>DELETE</td><td><code>/api/permissions/:id</code></td><td>åˆ é™¤æƒé™</td></tr></tbody></table><h4 id="å›¢é˜Ÿç®¡ç†-teams-7-ä¸ªç«¯ç‚¹" tabindex="-1">å›¢é˜Ÿç®¡ç† (Teams) - 7 ä¸ªç«¯ç‚¹ <a class="header-anchor" href="#å›¢é˜Ÿç®¡ç†-teams-7-ä¸ªç«¯ç‚¹" aria-label="Permalink to &quot;å›¢é˜Ÿç®¡ç† (Teams) - 7 ä¸ªç«¯ç‚¹&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>æ–¹æ³•</th><th>è·¯å¾„</th><th>æè¿°</th></tr></thead><tbody><tr><td>GET</td><td><code>/api/teams</code></td><td>è·å–å›¢é˜Ÿåˆ—è¡¨</td></tr><tr><td>GET</td><td><code>/api/teams/:id</code></td><td>è·å–å›¢é˜Ÿè¯¦æƒ…</td></tr><tr><td>POST</td><td><code>/api/teams</code></td><td>åˆ›å»ºå›¢é˜Ÿ</td></tr><tr><td>PUT</td><td><code>/api/teams/:id</code></td><td>æ›´æ–°å›¢é˜Ÿ</td></tr><tr><td>DELETE</td><td><code>/api/teams/:id</code></td><td>åˆ é™¤å›¢é˜Ÿ</td></tr><tr><td>POST</td><td><code>/api/teams/:id/members</code></td><td>æ·»åŠ æˆå‘˜</td></tr><tr><td>DELETE</td><td><code>/api/teams/:id/members/:userId</code></td><td>ç§»é™¤æˆå‘˜</td></tr></tbody></table><h4 id="æ–‡æ¡£ç®¡ç†-documents-11-ä¸ªç«¯ç‚¹" tabindex="-1">æ–‡æ¡£ç®¡ç† (Documents) - 11 ä¸ªç«¯ç‚¹ <a class="header-anchor" href="#æ–‡æ¡£ç®¡ç†-documents-11-ä¸ªç«¯ç‚¹" aria-label="Permalink to &quot;æ–‡æ¡£ç®¡ç† (Documents) - 11 ä¸ªç«¯ç‚¹&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>æ–¹æ³•</th><th>è·¯å¾„</th><th>æè¿°</th></tr></thead><tbody><tr><td>GET</td><td><code>/api/documents</code></td><td>è·å–æ–‡æ¡£åˆ—è¡¨</td></tr><tr><td>GET</td><td><code>/api/documents/:id</code></td><td>è·å–æ–‡æ¡£è¯¦æƒ…</td></tr><tr><td>POST</td><td><code>/api/documents</code></td><td>åˆ›å»ºæ–‡æ¡£</td></tr><tr><td>PUT</td><td><code>/api/documents/:id</code></td><td>æ›´æ–°æ–‡æ¡£</td></tr><tr><td>DELETE</td><td><code>/api/documents/:id</code></td><td>åˆ é™¤æ–‡æ¡£</td></tr><tr><td>POST</td><td><code>/api/documents/:id/share</code></td><td>åˆ†äº«æ–‡æ¡£</td></tr><tr><td>DELETE</td><td><code>/api/documents/:id/share/:shareId</code></td><td>å–æ¶ˆåˆ†äº«</td></tr><tr><td>POST</td><td><code>/api/documents/:id/tags</code></td><td>æ·»åŠ æ ‡ç­¾</td></tr><tr><td>DELETE</td><td><code>/api/documents/:id/tags/:tagId</code></td><td>ç§»é™¤æ ‡ç­¾</td></tr><tr><td>POST</td><td><code>/api/documents/:id/move</code></td><td>ç§»åŠ¨æ–‡æ¡£</td></tr><tr><td>POST</td><td><code>/api/documents/:id/copy</code></td><td>å¤åˆ¶æ–‡æ¡£</td></tr></tbody></table><h4 id="æ–‡ä»¶ç®¡ç†-files-14-ä¸ªç«¯ç‚¹" tabindex="-1">æ–‡ä»¶ç®¡ç† (Files) - 14 ä¸ªç«¯ç‚¹ <a class="header-anchor" href="#æ–‡ä»¶ç®¡ç†-files-14-ä¸ªç«¯ç‚¹" aria-label="Permalink to &quot;æ–‡ä»¶ç®¡ç† (Files) - 14 ä¸ªç«¯ç‚¹&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>æ–¹æ³•</th><th>è·¯å¾„</th><th>æè¿°</th></tr></thead><tbody><tr><td>GET</td><td><code>/api/files</code></td><td>è·å–æ–‡ä»¶åˆ—è¡¨</td></tr><tr><td>GET</td><td><code>/api/files/:id</code></td><td>è·å–æ–‡ä»¶è¯¦æƒ…</td></tr><tr><td>POST</td><td><code>/api/files/upload</code></td><td>ä¸Šä¼ æ–‡ä»¶</td></tr><tr><td>GET</td><td><code>/api/files/:id/download</code></td><td>ä¸‹è½½æ–‡ä»¶</td></tr><tr><td>PUT</td><td><code>/api/files/:id</code></td><td>æ›´æ–°æ–‡ä»¶ä¿¡æ¯</td></tr><tr><td>DELETE</td><td><code>/api/files/:id</code></td><td>åˆ é™¤æ–‡ä»¶</td></tr><tr><td>POST</td><td><code>/api/files/:id/move</code></td><td>ç§»åŠ¨æ–‡ä»¶</td></tr><tr><td>POST</td><td><code>/api/files/:id/copy</code></td><td>å¤åˆ¶æ–‡ä»¶</td></tr><tr><td>POST</td><td><code>/api/files/:id/share</code></td><td>åˆ†äº«æ–‡ä»¶</td></tr><tr><td>GET</td><td><code>/api/files/:id/versions</code></td><td>è·å–ç‰ˆæœ¬å†å²</td></tr><tr><td>GET</td><td><code>/api/files/storage</code></td><td>è·å–å­˜å‚¨ä¿¡æ¯</td></tr><tr><td>POST</td><td><code>/api/files/batch-delete</code></td><td>æ‰¹é‡åˆ é™¤</td></tr><tr><td>POST</td><td><code>/api/files/batch-move</code></td><td>æ‰¹é‡ç§»åŠ¨</td></tr><tr><td>POST</td><td><code>/api/files/search</code></td><td>æœç´¢æ–‡ä»¶</td></tr></tbody></table><h4 id="æ–‡ä»¶å¤¹ç®¡ç†-folders-5-ä¸ªç«¯ç‚¹" tabindex="-1">æ–‡ä»¶å¤¹ç®¡ç† (Folders) - 5 ä¸ªç«¯ç‚¹ <a class="header-anchor" href="#æ–‡ä»¶å¤¹ç®¡ç†-folders-5-ä¸ªç«¯ç‚¹" aria-label="Permalink to &quot;æ–‡ä»¶å¤¹ç®¡ç† (Folders) - 5 ä¸ªç«¯ç‚¹&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>æ–¹æ³•</th><th>è·¯å¾„</th><th>æè¿°</th></tr></thead><tbody><tr><td>GET</td><td><code>/api/folders</code></td><td>è·å–æ–‡ä»¶å¤¹æ ‘</td></tr><tr><td>POST</td><td><code>/api/folders</code></td><td>åˆ›å»ºæ–‡ä»¶å¤¹</td></tr><tr><td>PUT</td><td><code>/api/folders/:id</code></td><td>æ›´æ–°æ–‡ä»¶å¤¹</td></tr><tr><td>DELETE</td><td><code>/api/folders/:id</code></td><td>åˆ é™¤æ–‡ä»¶å¤¹</td></tr><tr><td>POST</td><td><code>/api/folders/:id/move</code></td><td>ç§»åŠ¨æ–‡ä»¶å¤¹</td></tr></tbody></table><h4 id="æ—¥å†ç®¡ç†-calendar-9-ä¸ªç«¯ç‚¹" tabindex="-1">æ—¥å†ç®¡ç† (Calendar) - 9 ä¸ªç«¯ç‚¹ <a class="header-anchor" href="#æ—¥å†ç®¡ç†-calendar-9-ä¸ªç«¯ç‚¹" aria-label="Permalink to &quot;æ—¥å†ç®¡ç† (Calendar) - 9 ä¸ªç«¯ç‚¹&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>æ–¹æ³•</th><th>è·¯å¾„</th><th>æè¿°</th></tr></thead><tbody><tr><td>GET</td><td><code>/api/calendar/events</code></td><td>è·å–æ—¥ç¨‹åˆ—è¡¨</td></tr><tr><td>GET</td><td><code>/api/calendar/events/:id</code></td><td>è·å–æ—¥ç¨‹è¯¦æƒ…</td></tr><tr><td>POST</td><td><code>/api/calendar/events</code></td><td>åˆ›å»ºæ—¥ç¨‹</td></tr><tr><td>PUT</td><td><code>/api/calendar/events/:id</code></td><td>æ›´æ–°æ—¥ç¨‹</td></tr><tr><td>DELETE</td><td><code>/api/calendar/events/:id</code></td><td>åˆ é™¤æ—¥ç¨‹</td></tr><tr><td>POST</td><td><code>/api/calendar/events/:id/attendees</code></td><td>æ·»åŠ å‚ä¼šäºº</td></tr><tr><td>DELETE</td><td><code>/api/calendar/events/:id/attendees/:userId</code></td><td>ç§»é™¤å‚ä¼šäºº</td></tr><tr><td>POST</td><td><code>/api/calendar/events/:id/reminder</code></td><td>è®¾ç½®æé†’</td></tr><tr><td>GET</td><td><code>/api/calendar/events/upcoming</code></td><td>è·å–å³å°†åˆ°æ¥çš„äº‹ä»¶</td></tr></tbody></table><h4 id="é€šçŸ¥ç®¡ç†-notifications-5-ä¸ªç«¯ç‚¹" tabindex="-1">é€šçŸ¥ç®¡ç† (Notifications) - 5 ä¸ªç«¯ç‚¹ <a class="header-anchor" href="#é€šçŸ¥ç®¡ç†-notifications-5-ä¸ªç«¯ç‚¹" aria-label="Permalink to &quot;é€šçŸ¥ç®¡ç† (Notifications) - 5 ä¸ªç«¯ç‚¹&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>æ–¹æ³•</th><th>è·¯å¾„</th><th>æè¿°</th></tr></thead><tbody><tr><td>GET</td><td><code>/api/notifications</code></td><td>è·å–é€šçŸ¥åˆ—è¡¨</td></tr><tr><td>GET</td><td><code>/api/notifications/:id</code></td><td>è·å–é€šçŸ¥è¯¦æƒ…</td></tr><tr><td>PUT</td><td><code>/api/notifications/:id/read</code></td><td>æ ‡è®°å·²è¯»</td></tr><tr><td>PUT</td><td><code>/api/notifications/read-all</code></td><td>å…¨éƒ¨å·²è¯»</td></tr><tr><td>DELETE</td><td><code>/api/notifications/:id</code></td><td>åˆ é™¤é€šçŸ¥</td></tr></tbody></table><h4 id="æ¶ˆæ¯ç®¡ç†-messages-5-ä¸ªç«¯ç‚¹" tabindex="-1">æ¶ˆæ¯ç®¡ç† (Messages) - 5 ä¸ªç«¯ç‚¹ <a class="header-anchor" href="#æ¶ˆæ¯ç®¡ç†-messages-5-ä¸ªç«¯ç‚¹" aria-label="Permalink to &quot;æ¶ˆæ¯ç®¡ç† (Messages) - 5 ä¸ªç«¯ç‚¹&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>æ–¹æ³•</th><th>è·¯å¾„</th><th>æè¿°</th></tr></thead><tbody><tr><td>GET</td><td><code>/api/messages/conversations</code></td><td>è·å–ä¼šè¯åˆ—è¡¨</td></tr><tr><td>GET</td><td><code>/api/messages/conversations/:id</code></td><td>è·å–ä¼šè¯è¯¦æƒ…</td></tr><tr><td>POST</td><td><code>/api/messages</code></td><td>å‘é€æ¶ˆæ¯</td></tr><tr><td>PUT</td><td><code>/api/messages/:id/read</code></td><td>æ ‡è®°å·²è¯»</td></tr><tr><td>DELETE</td><td><code>/api/messages/:id</code></td><td>åˆ é™¤æ¶ˆæ¯</td></tr></tbody></table><h4 id="ä»ªè¡¨ç›˜-dashboard-9-ä¸ªç«¯ç‚¹" tabindex="-1">ä»ªè¡¨ç›˜ (Dashboard) - 9 ä¸ªç«¯ç‚¹ <a class="header-anchor" href="#ä»ªè¡¨ç›˜-dashboard-9-ä¸ªç«¯ç‚¹" aria-label="Permalink to &quot;ä»ªè¡¨ç›˜ (Dashboard) - 9 ä¸ªç«¯ç‚¹&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>æ–¹æ³•</th><th>è·¯å¾„</th><th>æè¿°</th></tr></thead><tbody><tr><td>GET</td><td><code>/api/dashboard/stats</code></td><td>ç»Ÿè®¡æ•°æ®</td></tr><tr><td>GET</td><td><code>/api/dashboard/visits</code></td><td>è®¿é—®è¶‹åŠ¿</td></tr><tr><td>GET</td><td><code>/api/dashboard/sales</code></td><td>é”€å”®æ•°æ®</td></tr><tr><td>GET</td><td><code>/api/dashboard/pie</code></td><td>é¥¼å›¾æ•°æ®</td></tr><tr><td>GET</td><td><code>/api/dashboard/tasks</code></td><td>å¾…åŠä»»åŠ¡</td></tr><tr><td>GET</td><td><code>/api/dashboard/calendar</code></td><td>ä»Šæ—¥æ—¥ç¨‹</td></tr><tr><td>GET</td><td><code>/api/dashboard/activities</code></td><td>æœ€è¿‘æ´»åŠ¨</td></tr><tr><td>GET</td><td><code>/api/dashboard/notifications</code></td><td>æœªè¯»é€šçŸ¥</td></tr><tr><td>GET</td><td><code>/api/dashboard/users</code></td><td>ç”¨æˆ·ç»Ÿè®¡</td></tr></tbody></table><h2 id="è®¤è¯æœºåˆ¶" tabindex="-1">è®¤è¯æœºåˆ¶ <a class="header-anchor" href="#è®¤è¯æœºåˆ¶" aria-label="Permalink to &quot;è®¤è¯æœºåˆ¶&quot;">â€‹</a></h2><h3 id="jwt-åŒä»¤ç‰Œ" tabindex="-1">JWT åŒä»¤ç‰Œ <a class="header-anchor" href="#jwt-åŒä»¤ç‰Œ" aria-label="Permalink to &quot;JWT åŒä»¤ç‰Œ&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Access Token:  7 å¤©æœ‰æ•ˆæœŸï¼Œç”¨äº API è¯·æ±‚</span></span>
<span class="line"><span>Refresh Token: 30 å¤©æœ‰æ•ˆæœŸï¼Œç”¨äºåˆ·æ–° Access Token</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="è¯·æ±‚å¤´" tabindex="-1">è¯·æ±‚å¤´ <a class="header-anchor" href="#è¯·æ±‚å¤´" aria-label="Permalink to &quot;è¯·æ±‚å¤´&quot;">â€‹</a></h3><div class="language-http vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Authorization</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Bearer &lt;access_token&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="åˆ·æ–°æµç¨‹" tabindex="-1">åˆ·æ–°æµç¨‹ <a class="header-anchor" href="#åˆ·æ–°æµç¨‹" aria-label="Permalink to &quot;åˆ·æ–°æµç¨‹&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// POST /api/auth/refresh</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/auth/refresh&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;POST&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  headers: { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Content-Type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;application/json&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  body: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ refreshToken: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;your_refresh_token&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">accessToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">refreshToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ›´æ–°æœ¬åœ°å­˜å‚¨çš„ä»¤ç‰Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;accessToken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, accessToken);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;refreshToken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, refreshToken);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="æƒé™ç³»ç»Ÿ" tabindex="-1">æƒé™ç³»ç»Ÿ <a class="header-anchor" href="#æƒé™ç³»ç»Ÿ" aria-label="Permalink to &quot;æƒé™ç³»ç»Ÿ&quot;">â€‹</a></h2><h3 id="è§’è‰²å®šä¹‰" tabindex="-1">è§’è‰²å®šä¹‰ <a class="header-anchor" href="#è§’è‰²å®šä¹‰" aria-label="Permalink to &quot;è§’è‰²å®šä¹‰&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>è§’è‰²</th><th>è¯´æ˜</th><th>æƒé™</th></tr></thead><tbody><tr><td><code>super_admin</code></td><td>è¶…çº§ç®¡ç†å‘˜</td><td><code>*</code> (æ‰€æœ‰æƒé™)</td></tr><tr><td><code>admin</code></td><td>ç®¡ç†å‘˜</td><td><code>users:*</code>, <code>documents:*</code>, <code>files:*</code>, <code>teams:*</code></td></tr><tr><td><code>user</code></td><td>æ™®é€šç”¨æˆ·</td><td><code>documents:view</code>, <code>files:view</code>, <code>calendar:*</code></td></tr><tr><td><code>guest</code></td><td>è®¿å®¢</td><td><code>dashboard:view</code></td></tr></tbody></table><h3 id="æƒé™æ ¼å¼" tabindex="-1">æƒé™æ ¼å¼ <a class="header-anchor" href="#æƒé™æ ¼å¼" aria-label="Permalink to &quot;æƒé™æ ¼å¼&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>{resource}:{action}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ç¤ºä¾‹ï¼š</span></span>
<span class="line"><span>- users:view      # æŸ¥çœ‹ç”¨æˆ·</span></span>
<span class="line"><span>- users:create    # åˆ›å»ºç”¨æˆ·</span></span>
<span class="line"><span>- users:*         # ç”¨æˆ·æ‰€æœ‰æ“ä½œ</span></span>
<span class="line"><span>- *               # æ‰€æœ‰æƒé™</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="æƒé™éªŒè¯ç¤ºä¾‹" tabindex="-1">æƒé™éªŒè¯ç¤ºä¾‹ <a class="header-anchor" href="#æƒé™éªŒè¯ç¤ºä¾‹" aria-label="Permalink to &quot;æƒé™éªŒè¯ç¤ºä¾‹&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åœ¨è·¯ç”±ä¸­ä½¿ç”¨æƒé™ä¸­é—´ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { requireAuth, requirePermission } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./middleware/auth&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// éœ€è¦è®¤è¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/users/me&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, requireAuth, getUserProfile);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// éœ€è¦ç‰¹å®šæƒé™</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/users&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, requireAuth, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">requirePermission</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;users:create&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), createUser);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// éœ€è¦å¤šä¸ªæƒé™ä¹‹ä¸€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/users/:id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, requireAuth, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">requirePermission</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;users:update&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;users:*&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]), updateUser);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="é”™è¯¯å¤„ç†" tabindex="-1">é”™è¯¯å¤„ç† <a class="header-anchor" href="#é”™è¯¯å¤„ç†" aria-label="Permalink to &quot;é”™è¯¯å¤„ç†&quot;">â€‹</a></h2><h3 id="é”™è¯¯å“åº”æ ¼å¼" tabindex="-1">é”™è¯¯å“åº”æ ¼å¼ <a class="header-anchor" href="#é”™è¯¯å“åº”æ ¼å¼" aria-label="Permalink to &quot;é”™è¯¯å“åº”æ ¼å¼&quot;">â€‹</a></h3><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;code&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;VALIDATION_ERROR&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;è¯·æ±‚å‚æ•°éªŒè¯å¤±è´¥&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;details&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;field&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;email&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;é‚®ç®±æ ¼å¼ä¸æ­£ç¡®&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="é”™è¯¯ç " tabindex="-1">é”™è¯¯ç  <a class="header-anchor" href="#é”™è¯¯ç " aria-label="Permalink to &quot;é”™è¯¯ç &quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>çŠ¶æ€ç </th><th>é”™è¯¯ç </th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>400</td><td><code>VALIDATION_ERROR</code></td><td>å‚æ•°éªŒè¯å¤±è´¥</td></tr><tr><td>401</td><td><code>UNAUTHORIZED</code></td><td>æœªæˆæƒ</td></tr><tr><td>403</td><td><code>FORBIDDEN</code></td><td>æ— æƒé™</td></tr><tr><td>404</td><td><code>NOT_FOUND</code></td><td>èµ„æºä¸å­˜åœ¨</td></tr><tr><td>409</td><td><code>CONFLICT</code></td><td>èµ„æºå†²çª</td></tr><tr><td>500</td><td><code>INTERNAL_ERROR</code></td><td>æœåŠ¡å™¨é”™è¯¯</td></tr></tbody></table><h2 id="å¸¸ç”¨å‘½ä»¤" tabindex="-1">å¸¸ç”¨å‘½ä»¤ <a class="header-anchor" href="#å¸¸ç”¨å‘½ä»¤" aria-label="Permalink to &quot;å¸¸ç”¨å‘½ä»¤&quot;">â€‹</a></h2><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¼€å‘</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              # å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆçƒ­é‡è½½ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # TypeScript ç¼–è¯‘</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æµ‹è¯•</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             # è¿è¡Œæµ‹è¯•</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test:coverage</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æµ‹è¯•è¦†ç›–ç‡</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ•°æ®åº“</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db:generate</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # ç”Ÿæˆ Prisma Client</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db:push</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # æ¨é€æ•°æ®åº“å˜æ›´</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db:migrate</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       # è¿è¡Œè¿ç§»</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db:studio</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Prisma Studioï¼ˆæ•°æ®åº“ GUIï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db:seed</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # å¡«å……ç§å­æ•°æ®</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä»£ç è´¨é‡</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lint</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             # ESLint æ£€æŸ¥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lint:fix</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         # è‡ªåŠ¨ä¿®å¤</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> format</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           # Prettier æ ¼å¼åŒ–</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="éƒ¨ç½²" tabindex="-1">éƒ¨ç½² <a class="header-anchor" href="#éƒ¨ç½²" aria-label="Permalink to &quot;éƒ¨ç½²&quot;">â€‹</a></h2><h3 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-label="Permalink to &quot;Docker&quot;">â€‹</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> halolight-api-node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 3001:3001</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> halolight-api-node</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="docker-compose" tabindex="-1">Docker Compose <a class="header-anchor" href="#docker-compose" aria-label="Permalink to &quot;Docker Compose&quot;">â€‹</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># docker-compose.yml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;3.8&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;3001:3001&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">NODE_ENV=production</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">DATABASE_URL=\${DATABASE_URL}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">JWT_SECRET=\${JWT_SECRET}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">REFRESH_TOKEN_SECRET=\${REFRESH_TOKEN_SECRET}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">unless-stopped</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    depends_on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">db</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">postgres:16-alpine</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      POSTGRES_DB</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">halolight</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      POSTGRES_USER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${DB_USER}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      POSTGRES_PASSWORD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${DB_PASSWORD}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">postgres_data:/var/lib/postgresql/data</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;5432:5432&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  postgres_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="ç”Ÿäº§ç¯å¢ƒé…ç½®" tabindex="-1">ç”Ÿäº§ç¯å¢ƒé…ç½® <a class="header-anchor" href="#ç”Ÿäº§ç¯å¢ƒé…ç½®" aria-label="Permalink to &quot;ç”Ÿäº§ç¯å¢ƒé…ç½®&quot;">â€‹</a></h3><div class="language-env vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">env</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>NODE_ENV=production</span></span>
<span class="line"><span>PORT=3001</span></span>
<span class="line"><span>DATABASE_URL=postgresql://user:pass@host:5432/halolight</span></span>
<span class="line"><span>JWT_SECRET=your-production-secret-minimum-32-characters</span></span>
<span class="line"><span>REFRESH_TOKEN_SECRET=your-refresh-secret-minimum-32-characters</span></span>
<span class="line"><span>CORS_ORIGIN=https://yourdomain.com</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="æµ‹è¯•" tabindex="-1">æµ‹è¯• <a class="header-anchor" href="#æµ‹è¯•" aria-label="Permalink to &quot;æµ‹è¯•&quot;">â€‹</a></h2><h3 id="è¿è¡Œæµ‹è¯•" tabindex="-1">è¿è¡Œæµ‹è¯• <a class="header-anchor" href="#è¿è¡Œæµ‹è¯•" aria-label="Permalink to &quot;è¿è¡Œæµ‹è¯•&quot;">â€‹</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¿è¡Œæ‰€æœ‰æµ‹è¯•</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¿è¡Œæµ‹è¯•è¦†ç›–ç‡</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test:coverage</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç›‘å¬æ¨¡å¼</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test:watch</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="æµ‹è¯•ç¤ºä¾‹" tabindex="-1">æµ‹è¯•ç¤ºä¾‹ <a class="header-anchor" href="#æµ‹è¯•ç¤ºä¾‹" aria-label="Permalink to &quot;æµ‹è¯•ç¤ºä¾‹&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// tests/auth.test.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;supertest&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> app </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;../src/index&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">describe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Authentication&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  it</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;should login successfully&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(app)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/auth/login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        email: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;admin@halolight.h7ml.cn&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        password: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;password123&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response.status).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response.body.success).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response.body.data).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toHaveProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;accessToken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response.body.data).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toHaveProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;refreshToken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  it</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;should reject invalid credentials&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(app)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/auth/login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        email: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;admin@halolight.h7ml.cn&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        password: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;wrongpassword&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response.status).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">401</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response.body.success).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h2 id="æ€§èƒ½æŒ‡æ ‡" tabindex="-1">æ€§èƒ½æŒ‡æ ‡ <a class="header-anchor" href="#æ€§èƒ½æŒ‡æ ‡" aria-label="Permalink to &quot;æ€§èƒ½æŒ‡æ ‡&quot;">â€‹</a></h2><h3 id="åŸºå‡†æµ‹è¯•" tabindex="-1">åŸºå‡†æµ‹è¯• <a class="header-anchor" href="#åŸºå‡†æµ‹è¯•" aria-label="Permalink to &quot;åŸºå‡†æµ‹è¯•&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>æŒ‡æ ‡</th><th>æ•°å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>è¯·æ±‚ååé‡</td><td>~8,000 req/s</td><td>å•æ ¸ï¼Œç®€å•æŸ¥è¯¢</td></tr><tr><td>å¹³å‡å“åº”æ—¶é—´</td><td>&lt;10ms</td><td>æœ¬åœ°æ•°æ®åº“ï¼Œæ— å¤æ‚æŸ¥è¯¢</td></tr><tr><td>å†…å­˜å ç”¨</td><td>~80MB</td><td>å¯åŠ¨ååŸºç¡€å†…å­˜</td></tr><tr><td>CPU ä½¿ç”¨ç‡</td><td>&lt;5%</td><td>ç©ºé—²çŠ¶æ€</td></tr></tbody></table><h3 id="æ€§èƒ½ä¼˜åŒ–å»ºè®®" tabindex="-1">æ€§èƒ½ä¼˜åŒ–å»ºè®® <a class="header-anchor" href="#æ€§èƒ½ä¼˜åŒ–å»ºè®®" aria-label="Permalink to &quot;æ€§èƒ½ä¼˜åŒ–å»ºè®®&quot;">â€‹</a></h3><ul><li>ä½¿ç”¨è¿æ¥æ± ç®¡ç†æ•°æ®åº“è¿æ¥</li><li>å¯ç”¨æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢</li><li>å®ç°ç¼“å­˜ç­–ç•¥ (Redis)</li><li>ä½¿ç”¨ CDN åŠ é€Ÿé™æ€èµ„æº</li><li>å¯ç”¨ Gzip å‹ç¼©</li></ul><h2 id="å¯è§‚æµ‹æ€§" tabindex="-1">å¯è§‚æµ‹æ€§ <a class="header-anchor" href="#å¯è§‚æµ‹æ€§" aria-label="Permalink to &quot;å¯è§‚æµ‹æ€§&quot;">â€‹</a></h2><h3 id="æ—¥å¿—ç³»ç»Ÿ" tabindex="-1">æ—¥å¿—ç³»ç»Ÿ <a class="header-anchor" href="#æ—¥å¿—ç³»ç»Ÿ" aria-label="Permalink to &quot;æ—¥å¿—ç³»ç»Ÿ&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½¿ç”¨ Pino æ—¥å¿—è®°å½•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pino </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;pino&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> logger</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pino</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  level: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">LOG_LEVEL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;info&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  transport: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    target: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;pino-pretty&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    options: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      colorize: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      translateTime: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;yyyy-mm-dd HH:MM:ss&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ignore: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;pid,hostname&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è®°å½•è¯·æ±‚æ—¥å¿—</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  logger.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    method: req.method,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    url: req.url,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ip: req.ip</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Incoming request&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="å¥åº·æ£€æŸ¥" tabindex="-1">å¥åº·æ£€æŸ¥ <a class="header-anchor" href="#å¥åº·æ£€æŸ¥" aria-label="Permalink to &quot;å¥åº·æ£€æŸ¥&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// GET /health</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/health&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> health</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    status: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;healthy&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    timestamp: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toISOString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    uptime: process.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uptime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    database: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;connected&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ£€æŸ¥æ•°æ®åº“è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prisma.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$queryRaw</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`SELECT 1\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    health.status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;unhealthy&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    health.database </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;disconnected&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">503</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(health);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(health);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="ç›‘æ§æŒ‡æ ‡" tabindex="-1">ç›‘æ§æŒ‡æ ‡ <a class="header-anchor" href="#ç›‘æ§æŒ‡æ ‡" aria-label="Permalink to &quot;ç›‘æ§æŒ‡æ ‡&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é›†æˆ Prometheus æŒ‡æ ‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> promClient </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;prom-client&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> register</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> promClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Registry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é»˜è®¤æŒ‡æ ‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">promClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">collectDefaultMetrics</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ register });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è‡ªå®šä¹‰æŒ‡æ ‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> httpRequestDuration</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> promClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Histogram</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http_request_duration_seconds&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  help: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Duration of HTTP requests in seconds&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  labelNames: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;method&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;route&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;status_code&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  registers: [register]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æš´éœ²æŒ‡æ ‡ç«¯ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/metrics&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Content-Type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, register.contentType);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> register.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">metrics</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="å¸¸è§é—®é¢˜" tabindex="-1">å¸¸è§é—®é¢˜ <a class="header-anchor" href="#å¸¸è§é—®é¢˜" aria-label="Permalink to &quot;å¸¸è§é—®é¢˜&quot;">â€‹</a></h2><h3 id="q-å¦‚ä½•åœ¨å¤šæœåŠ¡é—´å…±äº«æ•°æ®åº“" tabindex="-1">Qï¼šå¦‚ä½•åœ¨å¤šæœåŠ¡é—´å…±äº«æ•°æ®åº“ï¼Ÿ <a class="header-anchor" href="#q-å¦‚ä½•åœ¨å¤šæœåŠ¡é—´å…±äº«æ•°æ®åº“" aria-label="Permalink to &quot;Qï¼šå¦‚ä½•åœ¨å¤šæœåŠ¡é—´å…±äº«æ•°æ®åº“ï¼Ÿ&quot;">â€‹</a></h3><p>Aï¼šé…ç½®ç›¸åŒçš„ <code>DATABASE_URL</code> å¹¶ç¡®ä¿ä½¿ç”¨ç›¸åŒçš„ Prisma Schemaã€‚</p><div class="language-env vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">env</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># æ‰€æœ‰æœåŠ¡ä½¿ç”¨ç›¸åŒçš„æ•°æ®åº“è¿æ¥</span></span>
<span class="line"><span>DATABASE_URL=&quot;postgresql://user:pass@shared-db:5432/halolight&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¡®ä¿ Schema ä¸€è‡´</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db:push</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="q-jwt-ä»¤ç‰Œè¿‡æœŸå¦‚ä½•è‡ªåŠ¨åˆ·æ–°" tabindex="-1">Qï¼šJWT ä»¤ç‰Œè¿‡æœŸå¦‚ä½•è‡ªåŠ¨åˆ·æ–°ï¼Ÿ <a class="header-anchor" href="#q-jwt-ä»¤ç‰Œè¿‡æœŸå¦‚ä½•è‡ªåŠ¨åˆ·æ–°" aria-label="Permalink to &quot;Qï¼šJWT ä»¤ç‰Œè¿‡æœŸå¦‚ä½•è‡ªåŠ¨åˆ·æ–°ï¼Ÿ&quot;">â€‹</a></h3><p>Aï¼šåœ¨å‰ç«¯æ‹¦æˆªå™¨ä¸­æ£€æµ‹ 401 é”™è¯¯ï¼Œè‡ªåŠ¨è°ƒç”¨åˆ·æ–°æ¥å£ã€‚</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Axios æ‹¦æˆªå™¨ç¤ºä¾‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">axios.interceptors.response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> originalRequest</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error.config;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error.response?.status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 401</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">originalRequest._retry) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      originalRequest._retry </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> refreshToken</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;refreshToken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> axios.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/auth/refresh&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { refreshToken });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;accessToken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, data.accessToken);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;refreshToken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, data.refreshToken);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        originalRequest.headers[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Authorization&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`Bearer \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">accessToken</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> axios</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(originalRequest);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (err) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // åˆ·æ–°å¤±è´¥ï¼Œè·³è½¬ç™»å½•é¡µ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        window.location.href </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(error);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="q-å¦‚ä½•å®ç°æ–‡ä»¶ä¸Šä¼ é™åˆ¶" tabindex="-1">Qï¼šå¦‚ä½•å®ç°æ–‡ä»¶ä¸Šä¼ é™åˆ¶ï¼Ÿ <a class="header-anchor" href="#q-å¦‚ä½•å®ç°æ–‡ä»¶ä¸Šä¼ é™åˆ¶" aria-label="Permalink to &quot;Qï¼šå¦‚ä½•å®ç°æ–‡ä»¶ä¸Šä¼ é™åˆ¶ï¼Ÿ&quot;">â€‹</a></h3><p>Aï¼šä½¿ç”¨ multer ä¸­é—´ä»¶é…ç½®æ–‡ä»¶å¤§å°å’Œç±»å‹é™åˆ¶ã€‚</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> multer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;multer&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> upload</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> multer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  limits: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fileSize: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1024</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 10MB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  fileFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> allowedTypes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;image/jpeg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;image/png&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;application/pdf&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (allowedTypes.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(file.mimetype)) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/files/upload&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, upload.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">single</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;file&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), uploadFile);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="q-å¦‚ä½•å¯ç”¨-https" tabindex="-1">Qï¼šå¦‚ä½•å¯ç”¨ HTTPSï¼Ÿ <a class="header-anchor" href="#q-å¦‚ä½•å¯ç”¨-https" aria-label="Permalink to &quot;Qï¼šå¦‚ä½•å¯ç”¨ HTTPSï¼Ÿ&quot;">â€‹</a></h3><p>Aï¼šä½¿ç”¨ Nginx åå‘ä»£ç†æˆ–åœ¨ Express ä¸­é…ç½® SSL è¯ä¹¦ã€‚</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Express ä¸­å¯ç”¨ HTTPS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> https </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;https&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  key: fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;path/to/private-key.pem&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cert: fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;path/to/certificate.pem&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">https.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(options, app).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;HTTPS server running on port 443&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="å¼€å‘å·¥å…·" tabindex="-1">å¼€å‘å·¥å…· <a class="header-anchor" href="#å¼€å‘å·¥å…·" aria-label="Permalink to &quot;å¼€å‘å·¥å…·&quot;">â€‹</a></h2><h3 id="æ¨èæ’ä»¶-å·¥å…·" tabindex="-1">æ¨èæ’ä»¶/å·¥å…· <a class="header-anchor" href="#æ¨èæ’ä»¶-å·¥å…·" aria-label="Permalink to &quot;æ¨èæ’ä»¶/å·¥å…·&quot;">â€‹</a></h3><ul><li><strong>Prisma Studio</strong> - å¯è§†åŒ–æ•°æ®åº“ç®¡ç†å·¥å…· (<code>pnpm db:studio</code>)</li><li><strong>Postman</strong> - API æµ‹è¯•å·¥å…· (å¯å¯¼å…¥ Swagger æ–‡æ¡£)</li><li><strong>VSCode Extension Pack</strong> - ESLint + Prettier + TypeScript</li><li><strong>Docker Desktop</strong> - å®¹å™¨ç®¡ç†</li><li><strong>pgAdmin</strong> - PostgreSQL æ•°æ®åº“ç®¡ç†</li></ul><h3 id="vscode-é…ç½®" tabindex="-1">VSCode é…ç½® <a class="header-anchor" href="#vscode-é…ç½®" aria-label="Permalink to &quot;VSCode é…ç½®&quot;">â€‹</a></h3><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// .vscode/settings.json</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;editor.formatOnSave&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;editor.defaultFormatter&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;esbenp.prettier-vscode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;editor.codeActionsOnSave&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;source.fixAll.eslint&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;typescript.tsdk&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node_modules/typescript/lib&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="ä¸å…¶ä»–åç«¯å¯¹æ¯”" tabindex="-1">ä¸å…¶ä»–åç«¯å¯¹æ¯” <a class="header-anchor" href="#ä¸å…¶ä»–åç«¯å¯¹æ¯”" aria-label="Permalink to &quot;ä¸å…¶ä»–åç«¯å¯¹æ¯”&quot;">â€‹</a></h2><table tabindex="0"><thead><tr><th>ç‰¹æ€§</th><th>Express</th><th>NestJS</th><th>Fastify</th><th>Koa</th></tr></thead><tbody><tr><td>è¯­è¨€</td><td>JavaScript/TypeScript</td><td>TypeScript</td><td>JavaScript/TypeScript</td><td>JavaScript/TypeScript</td></tr><tr><td>æ€§èƒ½</td><td>â­â­â­</td><td>â­â­â­</td><td>â­â­â­â­â­</td><td>â­â­â­â­</td></tr><tr><td>å­¦ä¹ æ›²çº¿</td><td>â­â­â­â­â­</td><td>â­â­â­</td><td>â­â­â­â­</td><td>â­â­â­â­</td></tr><tr><td>ç”Ÿæ€ç³»ç»Ÿ</td><td>â­â­â­â­â­</td><td>â­â­â­â­</td><td>â­â­â­â­</td><td>â­â­â­</td></tr><tr><td>å†…ç½®åŠŸèƒ½</td><td>â­â­</td><td>â­â­â­â­â­</td><td>â­â­â­â­</td><td>â­â­</td></tr><tr><td>ç¤¾åŒºæ”¯æŒ</td><td>â­â­â­â­â­</td><td>â­â­â­â­</td><td>â­â­â­â­</td><td>â­â­â­</td></tr></tbody></table><h3 id="ä¸ºä»€ä¹ˆé€‰æ‹©-express" tabindex="-1">ä¸ºä»€ä¹ˆé€‰æ‹© Expressï¼Ÿ <a class="header-anchor" href="#ä¸ºä»€ä¹ˆé€‰æ‹©-express" aria-label="Permalink to &quot;ä¸ºä»€ä¹ˆé€‰æ‹© Expressï¼Ÿ&quot;">â€‹</a></h3><ul><li><strong>æˆç†Ÿç¨³å®š</strong> - è¶…è¿‡ 10 å¹´çš„ç”Ÿäº§éªŒè¯</li><li><strong>çµæ´»æ€§é«˜</strong> - æœ€å°åŒ–æ¡†æ¶ï¼Œå¯è‡ªç”±ç»„åˆä¸­é—´ä»¶</li><li><strong>ç”Ÿæ€ä¸°å¯Œ</strong> - æµ·é‡ç¬¬ä¸‰æ–¹æ’ä»¶å’Œå·¥å…·</li><li><strong>å­¦ä¹ æˆæœ¬ä½</strong> - ç®€å•æ˜“æ‡‚ï¼Œé€‚åˆå¿«é€Ÿä¸Šæ‰‹</li><li><strong>ç¤¾åŒºæ´»è·ƒ</strong> - å¤§é‡æ–‡æ¡£å’Œé—®é¢˜è§£ç­”</li></ul><h2 id="ç›¸å…³é“¾æ¥" tabindex="-1">ç›¸å…³é“¾æ¥ <a class="header-anchor" href="#ç›¸å…³é“¾æ¥" aria-label="Permalink to &quot;ç›¸å…³é“¾æ¥&quot;">â€‹</a></h2><ul><li><a href="https://halolight-api-node.h7ml.cn/docs" target="_blank" rel="noreferrer">API æ–‡æ¡£</a></li><li><a href="https://github.com/halolight/halolight-api-node" target="_blank" rel="noreferrer">GitHub ä»“åº“</a></li><li><a href="https://expressjs.com/" target="_blank" rel="noreferrer">Express å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://www.prisma.io/docs" target="_blank" rel="noreferrer">Prisma æ–‡æ¡£</a></li><li><a href="https://www.typescriptlang.org/docs/" target="_blank" rel="noreferrer">TypeScript æ–‡æ¡£</a></li><li><a href="https://docs.halolight.h7ml.cn" target="_blank" rel="noreferrer">HaloLight æ–‡æ¡£</a></li></ul>`,120)])])}const o=a(e,[["render",l]]);export{c as __pageData,o as default};
