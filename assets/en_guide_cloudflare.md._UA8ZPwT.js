import{_ as a,c as i,o as n,a3 as e}from"./chunks/framework.BuRUkFgc.js";const c=JSON.parse('{"title":"Cloudflare Version","description":"","frontmatter":{},"headers":[],"relativePath":"en/guide/cloudflare.md","filePath":"en/guide/cloudflare.md","lastUpdated":1764772702000}'),t={name:"en/guide/cloudflare.md"};function l(p,s,r,h,d,o){return n(),i("div",{"data-pagefind-body":!0,"data-pagefind-meta":"date:1764772702000"},[...s[0]||(s[0]=[e(`<h1 id="cloudflare-version" tabindex="-1">Cloudflare Version <a class="header-anchor" href="#cloudflare-version" aria-label="Permalink to &quot;Cloudflare Version&quot;">​</a></h1><p>HaloLight Cloudflare version is built on Next.js 15 App Router + React 19, using <code>@opennextjs/cloudflare</code> adapter for Cloudflare Workers/Pages edge runtime, enabling global low-latency access.</p><p><strong>Live Preview</strong>: <a href="https://halolight-cloudflare.h7ml.cn/" target="_blank" rel="noreferrer">https://halolight-cloudflare.h7ml.cn/</a></p><p><strong>GitHub</strong>: <a href="https://github.com/halolight/halolight-cloudflare" target="_blank" rel="noreferrer">https://github.com/halolight/halolight-cloudflare</a></p><h2 id="differences-from-original" tabindex="-1">Differences from Original <a class="header-anchor" href="#differences-from-original" aria-label="Permalink to &quot;Differences from Original&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Feature</th><th>Original (Next.js)</th><th>Cloudflare Version</th></tr></thead><tbody><tr><td>Next.js</td><td>14.x</td><td>15.5.x</td></tr><tr><td>React</td><td>18.x</td><td>19.x</td></tr><tr><td>Runtime</td><td>Node.js (Vercel)</td><td>Cloudflare Workers (Edge)</td></tr><tr><td>Deployment Platform</td><td>Vercel / Docker</td><td>Cloudflare Pages</td></tr><tr><td>Development Tools</td><td>webpack</td><td>Turbopack</td></tr><tr><td>Deployment Command</td><td><code>pnpm build &amp;&amp; pnpm start</code></td><td><code>pnpm deploy</code></td></tr><tr><td>SSR Location</td><td>Server/Serverless</td><td>Global edge nodes</td></tr><tr><td>Cold Start</td><td>Platform-dependent</td><td>&lt; 50ms</td></tr></tbody></table><h2 id="tech-stack" tabindex="-1">Tech Stack <a class="header-anchor" href="#tech-stack" aria-label="Permalink to &quot;Tech Stack&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Technology</th><th>Version</th><th>Description</th></tr></thead><tbody><tr><td>Next.js</td><td>15.5.x</td><td>React full-stack framework</td></tr><tr><td>React</td><td>19.x</td><td>UI library</td></tr><tr><td>TypeScript</td><td>5.x</td><td>Type safety</td></tr><tr><td>Tailwind CSS</td><td>4.x</td><td>Atomic CSS</td></tr><tr><td>@opennextjs/cloudflare</td><td>1.x</td><td>Cloudflare adapter layer</td></tr><tr><td>Wrangler</td><td>4.x</td><td>Cloudflare CLI</td></tr><tr><td>shadcn/ui</td><td>latest</td><td>UI component library</td></tr><tr><td>Zustand</td><td>5.x</td><td>State management</td></tr><tr><td>TanStack Query</td><td>5.x</td><td>Server state</td></tr><tr><td>Vitest</td><td>4.x</td><td>Unit testing</td></tr><tr><td>Mock.js</td><td>1.x</td><td>Data mocking</td></tr></tbody></table><h2 id="directory-structure" tabindex="-1">Directory Structure <a class="header-anchor" href="#directory-structure" aria-label="Permalink to &quot;Directory Structure&quot;">​</a></h2><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>halolight-cloudflare/</span></span>
<span class="line"><span>├── src/</span></span>
<span class="line"><span>│   ├── app/                      # App Router pages</span></span>
<span class="line"><span>│   │   ├── (dashboard)/          # Dashboard route group</span></span>
<span class="line"><span>│   │   ├── (auth)/               # Auth route group</span></span>
<span class="line"><span>│   │   ├── (legal)/              # Legal terms route group</span></span>
<span class="line"><span>│   │   ├── layout.tsx            # Root layout</span></span>
<span class="line"><span>│   │   └── page.tsx              # Homepage</span></span>
<span class="line"><span>│   ├── components/               # React components</span></span>
<span class="line"><span>│   │   ├── ui/                   # shadcn/ui components</span></span>
<span class="line"><span>│   │   ├── layout/               # Layout components</span></span>
<span class="line"><span>│   │   └── dashboard/            # Dashboard components</span></span>
<span class="line"><span>│   ├── hooks/                    # React Hooks</span></span>
<span class="line"><span>│   ├── stores/                   # Zustand Stores</span></span>
<span class="line"><span>│   ├── lib/                      # Utilities</span></span>
<span class="line"><span>│   ├── mock/                     # Mock data</span></span>
<span class="line"><span>│   ├── providers/                # Context Providers</span></span>
<span class="line"><span>│   ├── config/                   # Configuration files</span></span>
<span class="line"><span>│   └── __tests__/                # Unit tests</span></span>
<span class="line"><span>├── public/                       # Static assets</span></span>
<span class="line"><span>├── .github/workflows/            # GitHub Actions CI</span></span>
<span class="line"><span>├── .open-next/                   # OpenNext build output (auto-generated)</span></span>
<span class="line"><span>├── coverage/                     # Test coverage (auto-generated)</span></span>
<span class="line"><span>├── cloudflare-env.d.ts           # Cloudflare environment types</span></span>
<span class="line"><span>├── vitest.config.ts              # Vitest test configuration</span></span>
<span class="line"><span>├── open-next.config.ts           # OpenNext configuration</span></span>
<span class="line"><span>├── wrangler.jsonc                # Wrangler configuration</span></span>
<span class="line"><span>├── next.config.ts                # Next.js configuration</span></span>
<span class="line"><span>└── package.json</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="quick-start" tabindex="-1">Quick Start <a class="header-anchor" href="#quick-start" aria-label="Permalink to &quot;Quick Start&quot;">​</a></h2><h3 id="requirements" tabindex="-1">Requirements <a class="header-anchor" href="#requirements" aria-label="Permalink to &quot;Requirements&quot;">​</a></h3><ul><li>Node.js &gt;= 18</li><li>pnpm &gt;= 8</li><li>Wrangler CLI (requires Cloudflare login)</li></ul><h3 id="installation" tabindex="-1">Installation <a class="header-anchor" href="#installation" aria-label="Permalink to &quot;Installation&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/halolight/halolight-cloudflare.git</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> halolight-cloudflare</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="environment-variables" tabindex="-1">Environment Variables <a class="header-anchor" href="#environment-variables" aria-label="Permalink to &quot;Environment Variables&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .dev.vars.example</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .dev.vars</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># .dev.vars example</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NEXT_PUBLIC_API_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/api</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NEXT_PUBLIC_MOCK</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NEXT_PUBLIC_APP_TITLE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">HaloLight</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NEXT_PUBLIC_BRAND_NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">HaloLight</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NEXT_PUBLIC_DEMO_EMAIL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">admin@halolight.h7ml.cn</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NEXT_PUBLIC_DEMO_PASSWORD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Admin@123</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="start-development" tabindex="-1">Start Development <a class="header-anchor" href="#start-development" aria-label="Permalink to &quot;Start Development&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Visit <a href="http://localhost:3000" target="_blank" rel="noreferrer">http://localhost:3000</a></p><h3 id="local-preview-edge-environment" tabindex="-1">Local Preview (Edge Environment) <a class="header-anchor" href="#local-preview-edge-environment" aria-label="Permalink to &quot;Local Preview (Edge Environment)&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> preview</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Simulates Cloudflare Workers environment to detect Edge Runtime compatibility issues.</p><h3 id="deploy-to-cloudflare" tabindex="-1">Deploy to Cloudflare <a class="header-anchor" href="#deploy-to-cloudflare" aria-label="Permalink to &quot;Deploy to Cloudflare&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wrangler</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> login</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # Login required for first time</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deploy</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # Build and deploy</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="common-scripts" tabindex="-1">Common Scripts <a class="header-anchor" href="#common-scripts" aria-label="Permalink to &quot;Common Scripts&quot;">​</a></h2><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # Start development server (Turbopack, Node.js environment)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Next.js production build</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> preview</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # Local preview of Cloudflare environment</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deploy</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       # Deploy to Cloudflare</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> upload</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       # Upload only without deployment</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lint</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         # ESLint check</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> type-check</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # TypeScript type check</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         # Run unit tests (watch mode)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test:run</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     # Run unit tests (single run)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test:coverage</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # Run tests and generate coverage report</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cf-typegen</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # Generate Cloudflare environment types</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="edge-runtime-constraints" tabindex="-1">Edge Runtime Constraints <a class="header-anchor" href="#edge-runtime-constraints" aria-label="Permalink to &quot;Edge Runtime Constraints&quot;">​</a></h2><p>Cloudflare Workers is an edge runtime, some Node.js APIs are unavailable:</p><p><strong>Unavailable APIs</strong>:</p><ul><li><code>fs</code> - File system operations</li><li><code>child_process</code> - Child processes</li><li><code>net</code>, <code>dgram</code> - Native network sockets</li><li><code>crypto.createCipher</code> and other legacy crypto APIs</li></ul><p><strong>Partially Available</strong> (via nodejs_compat):</p><ul><li><code>Buffer</code> - Binary data processing</li><li><code>process.env</code> - Environment variables</li><li><code>crypto</code> partial APIs - such as <code>randomUUID()</code></li></ul><div class="warning custom-block"><p class="custom-block-title">Note</p><p>When using <code>@opennextjs/cloudflare</code>, the entire application automatically runs in edge environment, no need to manually declare <code>export const runtime = &#39;edge&#39;</code>.</p></div><h2 id="cloudflare-services-integration" tabindex="-1">Cloudflare Services Integration <a class="header-anchor" href="#cloudflare-services-integration" aria-label="Permalink to &quot;Cloudflare Services Integration&quot;">​</a></h2><h3 id="available-services" tabindex="-1">Available Services <a class="header-anchor" href="#available-services" aria-label="Permalink to &quot;Available Services&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Service</th><th>Purpose</th><th>Description</th></tr></thead><tbody><tr><td>KV</td><td>Key-value storage</td><td>Globally distributed cache</td></tr><tr><td>D1</td><td>SQLite database</td><td>Edge SQL database</td></tr><tr><td>R2</td><td>Object storage</td><td>S3-compatible storage</td></tr><tr><td>Queues</td><td>Message queues</td><td>Async task processing</td></tr><tr><td>Durable Objects</td><td>Stateful objects</td><td>Real-time collaboration</td></tr><tr><td>Workers AI</td><td>AI inference</td><td>Edge AI models</td></tr></tbody></table><h3 id="usage-example" tabindex="-1">Usage Example <a class="header-anchor" href="#usage-example" aria-label="Permalink to &quot;Usage Example&quot;">​</a></h3><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { getRequestContext } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@opennextjs/cloudflare&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getRequestContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MY_KV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;key&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ value });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="configure-kv-storage" tabindex="-1">Configure KV Storage <a class="header-anchor" href="#configure-kv-storage" aria-label="Permalink to &quot;Configure KV Storage&quot;">​</a></h3><div class="language-jsonc vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">jsonc</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// wrangler.jsonc</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;kv_namespaces&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;binding&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MY_KV&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;xxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="configure-d1-database" tabindex="-1">Configure D1 Database <a class="header-anchor" href="#configure-d1-database" aria-label="Permalink to &quot;Configure D1 Database&quot;">​</a></h3><div class="language-jsonc vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">jsonc</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// wrangler.jsonc</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;d1_databases&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;binding&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MY_DB&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;database_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;xxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="ssr-ssg-isr-support" tabindex="-1">SSR/SSG/ISR Support <a class="header-anchor" href="#ssr-ssg-isr-support" aria-label="Permalink to &quot;SSR/SSG/ISR Support&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Rendering Mode</th><th>Support Status</th><th>Description</th></tr></thead><tbody><tr><td>SSR</td><td>✅ Supported</td><td>Each request renders at the edge</td></tr><tr><td>SSG</td><td>✅ Supported</td><td>Static pages generated at build time</td></tr><tr><td>ISR</td><td>⚠️ Partial</td><td>Requires R2 cache configuration</td></tr></tbody></table><h3 id="enable-isr" tabindex="-1">Enable ISR <a class="header-anchor" href="#enable-isr" aria-label="Permalink to &quot;Enable ISR&quot;">​</a></h3><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// open-next.config.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineCloudflareConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@opennextjs/cloudflare&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r2IncrementalCache </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@opennextjs/cloudflare/overrides/incremental-cache/r2-incremental-cache&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineCloudflareConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  incrementalCache: r2IncrementalCache,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="ci-cd" tabindex="-1">CI/CD <a class="header-anchor" href="#ci-cd" aria-label="Permalink to &quot;CI/CD&quot;">​</a></h2><p>Project has complete GitHub Actions CI workflow configured:</p><table tabindex="0"><thead><tr><th>Job</th><th>Description</th></tr></thead><tbody><tr><td><strong>lint</strong></td><td>ESLint + TypeScript type check</td></tr><tr><td><strong>test</strong></td><td>Vitest unit tests + Codecov coverage</td></tr><tr><td><strong>build</strong></td><td>OpenNext Cloudflare production build</td></tr><tr><td><strong>security</strong></td><td>Dependency security audit</td></tr><tr><td><strong>dependency-review</strong></td><td>PR dependency change review</td></tr></tbody></table><h3 id="deployment-workflow-example" tabindex="-1">Deployment Workflow Example <a class="header-anchor" href="#deployment-workflow-example" aria-label="Permalink to &quot;Deployment Workflow Example&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># .github/workflows/deploy.yml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deploy to Cloudflare</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    branches</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  deploy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/checkout@v4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm/action-setup@v4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/setup-node@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          node-version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm install</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm deploy</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          CLOUDFLARE_API_TOKEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.CF_API_TOKEN }}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="deployment-architecture" tabindex="-1">Deployment Architecture <a class="header-anchor" href="#deployment-architecture" aria-label="Permalink to &quot;Deployment Architecture&quot;">​</a></h2><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>User Request → Cloudflare CDN → Workers (Edge) → KV/D1/R2/External API</span></span>
<span class="line"><span>                ↓</span></span>
<span class="line"><span>          300+ global nodes</span></span>
<span class="line"><span>          Nearby response &lt; 50ms</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="quota-limits" tabindex="-1">Quota Limits <a class="header-anchor" href="#quota-limits" aria-label="Permalink to &quot;Quota Limits&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Limit</th><th>Free Tier</th><th>Paid Tier</th></tr></thead><tbody><tr><td>Worker script size</td><td>1MB (compressed)</td><td>10MB</td></tr><tr><td>CPU time</td><td>10-50ms</td><td>Seconds</td></tr><tr><td>Memory</td><td>128MB</td><td>128MB</td></tr><tr><td>Subrequests</td><td>50</td><td>1000</td></tr><tr><td>Request duration</td><td>30s</td><td>30s</td></tr></tbody></table><div class="tip custom-block"><p class="custom-block-title">Reference</p><p>For actual limits, check <a href="https://developers.cloudflare.com/workers/platform/limits/" target="_blank" rel="noreferrer">Cloudflare official documentation</a>.</p></div><h2 id="version-rollback" tabindex="-1">Version Rollback <a class="header-anchor" href="#version-rollback" aria-label="Permalink to &quot;Version Rollback&quot;">​</a></h2><p>Cloudflare Pages retains deployment history, supporting the following rollback methods:</p><ol><li><p><strong>Dashboard Rollback</strong>:</p><ul><li>Cloudflare Dashboard → Workers &amp; Pages → Project → Deployments</li><li>Select historical version → &quot;Rollback to this deployment&quot;</li></ul></li><li><p><strong>Redeploy Specific Commit</strong>:</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> checkout</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">commit-has</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deploy</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol><h2 id="common-issues" tabindex="-1">Common Issues <a class="header-anchor" href="#common-issues" aria-label="Permalink to &quot;Common Issues&quot;">​</a></h2><h3 id="cannot-find-module-fs-error" tabindex="-1">&quot;Cannot find module &#39;fs&#39;&quot; Error <a class="header-anchor" href="#cannot-find-module-fs-error" aria-label="Permalink to &quot;&quot;Cannot find module &#39;fs&#39;&quot; Error&quot;">​</a></h3><p>Edge Runtime doesn&#39;t support Node.js built-in modules. Use Web APIs instead or ensure the code only runs on the client side.</p><h3 id="build-size-too-large" tabindex="-1">Build Size Too Large <a class="header-anchor" href="#build-size-too-large" aria-label="Permalink to &quot;Build Size Too Large&quot;">​</a></h3><ul><li>Check if dependencies have Node.js-specific code</li><li>Use dynamic imports to split code</li><li>Remove unused dependencies</li></ul><h3 id="slow-cold-start" tabindex="-1">Slow Cold Start <a class="header-anchor" href="#slow-cold-start" aria-label="Permalink to &quot;Slow Cold Start&quot;">​</a></h3><ul><li>Reduce Worker script size</li><li>Use Smart Placement for nearby deployment</li><li>Warm up critical paths</li></ul><h2 id="related-links" tabindex="-1">Related Links <a class="header-anchor" href="#related-links" aria-label="Permalink to &quot;Related Links&quot;">​</a></h2><ul><li><a href="https://halolight-cloudflare.h7ml.cn" target="_blank" rel="noreferrer">Live Preview (Cloudflare)</a></li><li><a href="https://halolight.h7ml.cn" target="_blank" rel="noreferrer">Live Preview (Original Vercel)</a></li><li><a href="https://github.com/halolight/halolight-cloudflare" target="_blank" rel="noreferrer">GitHub Repository</a></li><li><a href="https://opennext.js.org/cloudflare" target="_blank" rel="noreferrer">OpenNext Documentation</a></li><li><a href="https://developers.cloudflare.com/workers/" target="_blank" rel="noreferrer">Cloudflare Workers Documentation</a></li></ul>`,70)])])}const u=a(t,[["render",l]]);export{c as __pageData,u as default};
