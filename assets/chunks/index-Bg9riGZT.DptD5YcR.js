import{d as C,p,c as x,q as b,v as M,X as I,o as E,G as N,j as T,w as O,e as V,T as A,n as F}from"./framework.BuRUkFgc.js";import{Z as K,f as L,a as z,v as D,F as H,p as P}from"./theme.UrnYZ8Qw.js";var k=(d,n,r)=>new Promise((l,u)=>{var v=t=>{try{a(r.next(t))}catch(e){u(e)}},i=t=>{try{a(r.throw(t))}catch(e){u(e)}},a=t=>t.done?l(t.value):Promise.resolve(t.value).then(v,i);a((r=r.apply(d,n)).next())});const S={key:0,class:"math-loading-overlay"},U=C({__name:"MathBlockNode",props:{node:{}},setup(d){const n=d,r=p(null),l=p(null);let u=!1,v=0,i=!1,a=null;const t=L();let e=null;const s=p(!0);function y(){return k(this,null,function*(){if(!n.node.content||!l.value||i)return;if(!u)try{!e&&r.value&&(e=t(r.value)),yield e==null?void 0:e.whenVisible}catch{}a&&(a.abort(),a=null);const c=++v,f=new AbortController;a=f,z(n.node.content,!0,{timeout:3e3,waitTimeout:2e3,maxRetries:1,signal:f.signal}).then(o=>{i||c!==v||l.value&&(l.value.innerHTML=o,u=!0,s.value=!1)}).catch(o=>k(null,null,function*(){if(i||c!==v||!l.value)return;const m=(o==null?void 0:o.code)||(o==null?void 0:o.name),R=m==="WORKER_INIT_ERROR"||(o==null?void 0:o.fallbackToRenderer),g=m===P||m==="WORKER_TIMEOUT",B=m==="KATEX_DISABLED";if(R||g){const w=yield D();if(w){try{const h=w.renderToString(n.node.content,{throwOnError:n.node.loading,displayMode:!0});l.value.innerHTML=h,u=!0,s.value=!1,H(n.node.content,!0,h)}catch{}return}}if(B){s.value=!1,l.value.textContent=n.node.raw;return}u||(s.value=!0),n.node.loading||(s.value=!1,l.value.textContent=n.node.raw)}))})}return b(()=>n.node.content,()=>{y()}),M(()=>{y()}),I(()=>{var c;i=!0,a&&(a.abort(),a=null),(c=e==null?void 0:e.destroy)==null||c.call(e),e=null}),(c,f)=>(E(),x("div",{ref_key:"containerEl",ref:r,class:"math-block text-center overflow-x-auto relative min-h-[40px]"},[N(A,{name:"math-fade"},{default:O(()=>[s.value?(E(),x("div",S,[...f[0]||(f[0]=[T("div",{class:"math-loading-spinner"},null,-1)])])):V("",!0)]),_:1}),T("div",{ref_key:"mathBlockElement",ref:l,class:F({"math-rendering":s.value})},null,2)],512))}}),_=K(U,[["__scopeId","data-v-dab27d4f"]]);_.install=d=>{d.component(_.__name,_)};export{_ as default};
